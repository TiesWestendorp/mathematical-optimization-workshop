# Battery charging problem

![Charging battery](charging_battery.png "Generated by ChatGPT")

In a smart grid, appliances decide their own activation time. Washing machines, dishwashers, electric vehicles, batteries, heating, ventilation and air conditioning may all delay action until better conditions arise. Depending on the stakeholder, this may be when electricity prices are lower, or to consume when energy is abundant or to deliver energy when it is scarce (irrespective of price) to flatten the energy curve.

Consider a 71.4 kWh capacity battery (the average electric vehicle battery), that can charge or discharge at a C-rating of 0.2C. This means it takes 5 hours to fully (dis)charge the battery (or 7.14 kWh within an hour). Every hour we can decide to charge or discharge somewhere within these allowed bounds, let $x_t$ be the charging decision for time $t$, and assume 100% round-trip efficiency (no energy losses), such that the state of charge $C_t$ at time $t$ can be found by simply summing the charging decisions up to time $t$ with the initial state of charge $C_0$:

$$C_t = C_0 + \sum_{k=1}^tx_k$$

Energy prices are always in flux. Attached are a several files with 1 hour window kWh-prices in euros for different dates:

- [prices-2025-4-18.csv](prices-2025-4-18.csv) contains the prices for 2025-04-18 for a 71.4 kWh capacity battery, starting at 15 kWh state of charge.
- [prices-2025-4-20.csv](prices-2025-4-20.csv) contains the prices for 2025-04-20 for a 71.4 kWh capacity battery, starting at 50 kWh state of charge.
- [prices-2025-4-21.csv](prices-2025-4-21.csv) contains the prices for 2025-04-21 for a 71.4 kWh capacity battery, starting at 15 kWh state of charge.

## Exercises

> We can never overdeplete or overcharge the battery; the state of charge at every moment in time ($1,\ldots,T$) must be between zero and the capacity of the battery. Also, we can at most discharge and charge a certain amount in each time interval.

$$\begin{matrix}
0 \leq C_0 + \sum_{k=1}^t x_k \leq C_\text{max}\hspace{1em} & \forall t=1,\ldots,T\\\
x_\text{min} \leq x_t \leq x_\text{max} \hspace{4em} & \forall t=1,\ldots,T\end{matrix}$$

> Assume that not only do we pay $c_t$ per kWh for charging the battery at time $t$, but we would also earn $c_t$ per kWh for discharging to the network. (Note that $c_t$ can be negative! In those cases, it's actually profitable to charge the battery.)

1. How can we utilize our battery in order to make the most profit? Write an [ILP program](https://en.wikipedia.org/wiki/Integer_programming) using [`scipy.optimize.linprog`](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linprog.html).

> The battery is fully depleted at the end of the day. This is fine for trading, but not if we also plan to use the car at some point.

2. Adapt your program such that it holds _at least_ the initial state of charge at the end of the day, such that the battery is more or less "stable".
3. Rather than only being stable, we want the battery to be somewhat usable after a certain period: the state of charge must be at least 50% for all time periods after 50% of time has elapsed. Adapt your program.
4. What do you suspect happens if multiple batteries are present in the network?
5. $\sum_{t=1}^T \left(c_t(x_t+p_t)^+ + s(x_t+p_t)^-\right)$